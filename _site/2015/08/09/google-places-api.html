<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Finding a cash machine with the Google Places API </title>
  <meta name="description" content="Trying to find a free cash machine is one of the great challenges faced by Londoners, up there with getting a pint for less than £4 and renting a property cl...">
  
  <meta name="author" content="Christopher Lovell">
  <meta name="copyright" content="&copy; Christopher Lovell 2016">
  

  <!-- Enable inline mathjax. Must be placed before loading Mathjax. See http://tex.stackexchange.com/questions/27633/mathjax-inline-mode-not-rendering -->
  <script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"] ],
        processEscapes: true
      }
    });
  </script>

  <!-- MathJax -->
  <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  <!-- Facebook (custom) -->
  <div id="fb-root"></div>
  <script>(function(d, s, id) {
    var js, fjs = d.getElementsByTagName(s)[0];
    if (d.getElementById(id)) return;
    js = d.createElement(s); js.id = id;
    js.src = "//connect.facebook.net/en_GB/sdk.js#xfbml=1&version=v2.4";
    fjs.parentNode.insertBefore(js, fjs);
  }(document, 'script', 'facebook-jssdk'));</script>

  <!-- twitter (custom) -->
  <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>

  <!-- External libraries -->
  <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.5/styles/monokai_sublime.min.css">
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/lightbox2/2.7.1/css/lightbox.css">

  <!-- Favicon and other icons (made with http://www.favicon-generator.org/) -->
  <link rel="shortcut icon" href="/assets/icons/favicon.ico" type="image/x-icon">
  <link rel="icon" href="/assets/icons/favicon.ico" type="image/x-icon">
  <link rel="apple-touch-icon" sizes="57x57" href="/assets/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/assets/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/assets/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/assets/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/assets/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/assets/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/assets/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/assets/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/assets/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192"  href="/assets/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/assets/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/assets/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/assets/icons/favicon-16x16.png">
  <link rel="manifest" href="/assets/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/assets/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">

  
  <!-- Facebook OGP cards -->
  <meta property="og:description" content="Trying to find a free cash machine is one of the great challenges faced by Londoners, up there with getting a pint for less than £4 and renting a property cl..." />
  <meta property="og:url" content="" />
  <meta property="og:site_name" content="Polyphant" />
  <meta property="og:title" content="Finding a cash machine with the Google Places API " />
  <meta property="og:type" content="website" />
  <meta property="og:image" content="/assets/logo.png" />
  <meta property="og:image:type" content="image/png" />
  <meta property="og:image:width" content="612" />
  <meta property="og:image:height" content="605" />
  

  
  <!-- Twitter: card tags -->
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Finding a cash machine with the Google Places API ">
  <meta name="twitter:description" content="Trying to find a free cash machine is one of the great challenges faced by Londoners, up there with getting a pint for less than £4 and renting a property cl...">
  <meta name="twitter:image" content="/assets/logo.png">
  <meta name="twitter:url" content="">
  

  

  <!-- Site styles -->
  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="/2015/08/09/google-places-api.html">
  <link rel="alternate" type="application/rss+xml" title="Polyphant" href="/feed.xml" />
</head>


  <body>

    
<header class="navigation" role="banner">
  <div class="navigation-wrapper">
    <a href="/" class="logo">
      
      <img src="/assets/logo.png" alt="Polyphant">
      
    </a>
    <a href="javascript:void(0)" class="navigation-menu-button" id="js-mobile-menu">
      <i class="fa fa-bars"></i>
    </a>
    <nav role="navigation">
      <ul id="js-navigation-menu" class="navigation-menu show">

        <li class="nav-link"><a href="/about">About</a></li>
        <li class="nav-link"><a href="/tags">Tags</a></li>
        <li class="nav-link"><a href="/contact">Contact</a></li>
        
        <!--
          
        
          
          <li class="nav-link"><a href="/contact/">Contact</a>
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
          <li class="nav-link"><a href="/about/">About</a>
          
        
          
          <li class="nav-link"><a href="/tags/">Tags</a>
          
        
          
        
          
        
          
        
          
        
          
        -->
      </ul>
    </nav>
  </div>
</header>


    <div class="page-content">
        <div class="post">

<div class="post-header-container " >
  <div class="scrim ">
    <header class="post-header">
      <h1 class="title">Finding a cash machine with the Google Places API </h1>
    </header>
  </div>
</div>

<div class="wrapper">

 <span class="page-divider">
  <span class="one"></span>
  <span class="two"></span>
</span>
 

<section class="post-meta">
  <div class="post-date">August 9, 2015</div>
  <div class="post-categories">
  
  </div>
</section>

<article class="post-content">
  <p>Trying to find a free cash machine is one of the great challenges faced by Londoners, up there with getting a pint for less than £4 and renting a property close to the center without having to live on bread and water for the rest of the year. Unfortunately web technology has been a bit tardy in coming up with a solution; there are some of independent web apps from different <a href="http://www.visa.com/atmlocator/index.jsp">machine</a> <a href="http://www.link.co.uk/ATMLocator/Pages/ATMLocator.aspx">companies</a>, and a couple of apps on the google app store with <a href="https://play.google.com/store/apps/details?id=com.moneypass&amp;hl=en">mixed</a> <a href="https://play.google.com/store/apps/details?id=com.souf.nearbyATM&amp;hl=en">reviews</a>, and that’s about it.</p>

<p>Whilst doing a project at work recently I discovered the <a href="https://developers.google.com/places/?hl=en">Google places API</a>, which provides an interface to Google Maps’ huge database of places around the globe. You can search for nearby places given a position, and filter by different place types, including <em>atm’s</em>. It doesn’t differentiate between surcharge free API’s, or those inside Bank’s, but it also doesn’t discriminate between ATM type; not perfect, but a start.</p>

<p>Below is a brief R script for producing a plot of the nearest ATM’s given a postcode. The google places API gives you 1000 requests per day, but if you enter your billing details you get up to 150000 (it won’t charge you, the details are only required to verify your identity).</p>

<p>The <code class="highlighter-rouge">rjson</code> library is used throughout for grabbing API data.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">library</span><span class="p">(</span><span class="n">rjson</span><span class="p">)</span></code></pre></figure>

<p>Below I query the google maps API for latitude and longitude coordinates given a postocde, in this case the <a href="http://www.historic-uk.com/CultureUK/The-Old-Lady-of-Threadneedle-Street/" target="blank">old lady</a> in the heart of the city. I construct the API request string, grab the JSON, test whether the look up was succesful, then assign the longitude and latitude data to variables with less verbose names.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">postcode</span> <span class="o">=</span> <span class="s2">"EC2R8AH"</span>

<span class="n">API_request</span> <span class="o">&lt;-</span> <span class="s2">"https://maps.googleapis.com/maps/api/geocode/json?address="</span>
<span class="n">API_request</span> <span class="o">&lt;-</span> <span class="n">paste</span><span class="p">(</span><span class="n">API_request</span><span class="p">,</span><span class="n">postcode</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s2">""</span><span class="p">)</span>

<span class="n">address</span> <span class="o">&lt;-</span> <span class="n">rjson</span><span class="o">::</span><span class="n">fromJSON</span><span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="n">API_request</span><span class="p">)</span>

<span class="k">if</span><span class="p">(</span><span class="n">address</span><span class="o">$</span><span class="n">status</span> <span class="o">!=</span> <span class="s2">"OK"</span><span class="p">){</span>
  <span class="n">stop</span><span class="p">(</span><span class="s2">"Error in API look up"</span><span class="p">)</span>
<span class="p">}</span>

<span class="n">latitude</span> <span class="o">&lt;-</span> <span class="n">address</span><span class="o">$</span><span class="n">results</span><span class="p">[[</span><span class="m">1</span><span class="p">]]</span><span class="o">$</span><span class="n">geometry</span><span class="o">$</span><span class="n">location</span><span class="o">$</span><span class="n">lat</span>
<span class="n">longitude</span> <span class="o">&lt;-</span> <span class="n">address</span><span class="o">$</span><span class="n">results</span><span class="p">[[</span><span class="m">1</span><span class="p">]]</span><span class="o">$</span><span class="n">geometry</span><span class="o">$</span><span class="n">location</span><span class="o">$</span><span class="n">lng</span></code></pre></figure>

<p>We’re now ready to query the places API. If you’ve verified your identity, you will be given a key which needs to be passed in the look up. If not, leave it as <code class="highlighter-rouge">NULL</code> and it’ll be left our of your query string later.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">key</span> <span class="o">=</span> <span class="s2">"..."</span></code></pre></figure>

<p>There are a number of different searches in the places API you can employ, detailed &lt;a href=”https://developers.google.com/places/webservice/search” target=”blank”here&lt;/a&gt;. I use the <em>nearby search</em>, which requires location coordinates and a radius within which to search. These are provided as ampersand separated arguments at the end of the URL. You can also specify whether to rank your results based on distance from your location. Finally, we add a <em>type</em> which we wish to return, <em>atm</em>. This will return the 20 nearest atm’s ranked by distance.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">API_request</span> <span class="o">&lt;-</span> <span class="s2">"https://maps.googleapis.com/maps/api/place/nearbysearch/json?radius=2000&amp;rankby=distance&amp;types=atm"</span>

<span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">is.null</span><span class="p">(</span><span class="n">key</span><span class="p">)){</span>
  <span class="n">API_request</span> <span class="o">&lt;-</span> <span class="n">paste</span><span class="p">(</span><span class="n">API_request</span><span class="p">,</span><span class="n">paste</span><span class="p">(</span><span class="s2">"&amp;key="</span><span class="p">,</span><span class="n">key</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s2">""</span><span class="p">),</span><span class="n">sep</span><span class="o">=</span><span class="s2">""</span><span class="p">)</span>
<span class="p">}</span>

<span class="n">API_request</span> <span class="o">&lt;-</span> <span class="n">paste</span><span class="p">(</span><span class="n">API_request</span><span class="p">,</span><span class="s2">"&amp;location="</span><span class="p">,</span> <span class="n">paste</span><span class="p">(</span><span class="n">latitude</span><span class="p">,</span><span class="n">longitude</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s2">","</span><span class="p">),</span><span class="n">sep</span><span class="o">=</span><span class="s2">""</span><span class="p">)</span>

<span class="n">bank_address</span> <span class="o">&lt;-</span> <span class="n">rjson</span><span class="o">::</span><span class="n">fromJSON</span><span class="p">(</span><span class="n">file</span> <span class="o">=</span> <span class="n">API_request</span><span class="p">,</span> <span class="n">unexpected.escape</span> <span class="o">=</span> <span class="s2">"keep"</span><span class="p">)</span>

<span class="k">if</span><span class="p">(</span><span class="n">bank_address</span><span class="o">$</span><span class="n">status</span> <span class="o">!=</span> <span class="s2">"OK"</span><span class="p">){</span>
  <span class="n">stop</span><span class="p">(</span><span class="s2">"Error in API look up"</span><span class="p">)</span>
<span class="p">}</span></code></pre></figure>

<p>To make the data easier to work with I use the <code class="highlighter-rouge">data.table</code> packages <code class="highlighter-rouge">rbindlist</code> function to flatten some key variables in the JSON in to a data table.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">library</span><span class="p">(</span><span class="n">data.table</span><span class="p">)</span>

<span class="n">bank.details</span> <span class="o">&lt;-</span> <span class="n">rbindlist</span><span class="p">(</span><span class="n">lapply</span><span class="p">(</span><span class="n">bank_address</span><span class="o">$</span><span class="n">results</span><span class="p">,</span> <span class="k">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="n">data.frame</span><span class="p">(</span><span class="n">as.numeric</span><span class="p">(</span><span class="n">x</span><span class="o">$</span><span class="n">geometry</span><span class="o">$</span><span class="n">location</span><span class="o">$</span><span class="n">lat</span><span class="p">[[</span><span class="m">1</span><span class="p">]]),</span>
                                                                                 <span class="n">as.numeric</span><span class="p">(</span><span class="n">x</span><span class="o">$</span><span class="n">geometry</span><span class="o">$</span><span class="n">location</span><span class="o">$</span><span class="n">lng</span><span class="p">[[</span><span class="m">1</span><span class="p">]]),</span>
                                                                                 <span class="n">as.character</span><span class="p">(</span><span class="n">x</span><span class="o">$</span><span class="n">name</span><span class="p">[[</span><span class="m">1</span><span class="p">]]),</span>
                                                                                 <span class="n">as.character</span><span class="p">(</span><span class="n">x</span><span class="o">$</span><span class="n">vicinity</span><span class="p">[[</span><span class="m">1</span><span class="p">]]))))</span>

<span class="n">setnames</span><span class="p">(</span><span class="n">bank.details</span><span class="p">,</span> <span class="n">c</span><span class="p">(</span><span class="s2">"Latitude"</span><span class="p">,</span><span class="s2">"Longitude"</span><span class="p">,</span><span class="s2">"Name"</span><span class="p">,</span><span class="s2">"Address"</span><span class="p">))</span></code></pre></figure>

<p>To plot the results I use the <code class="highlighter-rouge">ggmap</code> package, grabbing a map centered on the location provided at the start, with each ATM highlighted by a different colour.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">library</span><span class="p">(</span><span class="n">ggmap</span><span class="p">)</span>

<span class="n">map</span> <span class="o">&lt;-</span> <span class="n">get_map</span><span class="p">(</span><span class="n">location</span> <span class="o">=</span> <span class="n">c</span><span class="p">(</span><span class="n">longitude</span><span class="p">,</span><span class="n">latitude</span><span class="p">),</span> <span class="n">zoom</span> <span class="o">=</span> <span class="m">14</span><span class="p">,</span> <span class="n">maptype</span> <span class="o">=</span> <span class="s2">"roadmap"</span><span class="p">,</span> <span class="n">scale</span> <span class="o">=</span> <span class="m">2</span><span class="p">)</span>

<span class="n">ggmap</span><span class="p">(</span><span class="n">map</span><span class="p">)</span> <span class="o">+</span>
  <span class="n">geom_point</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="n">bank.details</span><span class="p">,</span> <span class="n">aes</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="n">Longitude</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">Latitude</span><span class="p">,</span> <span class="n">colour</span> <span class="o">=</span> <span class="n">Name</span><span class="p">),</span>
             <span class="n">size</span> <span class="o">=</span> <span class="m">8</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="m">0.3</span><span class="p">,</span> <span class="n">shape</span> <span class="o">=</span> <span class="m">19</span><span class="p">)</span></code></pre></figure>

<p><a href="/images/branches.png" data-lightbox="Nearest atm's to Bank" data-title="Nearest atm's to Bank">
  <img src="/images/branches.png" title="Nearest atm's to Bank" />
</a></p>

</article>



<section class="rss">
  <p class="rss-subscribe text"><strong>Subscribe <a href="/feed.xml">via RSS</a></strong></p>
</section>

<section class="share">

  <div class="fb-like" data-href="/2015/08/09/google-places-api.html" data-layout="button_count" data-action="like" data-show-faces="true" data-share="true"></div>
  <p class="post-social-meta">
    <a href="https://twitter.com/share" class="twitter-share-button" data-via="">Tweet</a>
    <script src="//platform.linkedin.com/in.js" type="text/javascript"> lang: en_US</script>
    <script type="IN/Share" data-url="/2015/08/09/google-places-api.html" data-counter="right"></script>
  </p>

</section>

	<section class="post-navigation">
		<span class="prev-post">
			
				<a href="/2015/07/18/reveal-phd.html">
					<span class="fa-stack fa-lg">
						<i class="fa fa-square fa-stack-2x"></i>
						<i class="fa fa-angle-double-left fa-stack-1x fa-inverse"></i>
					</span>
					<span class="page-number">PhD at UoS</span>
				</a>
			
		</span>
		<span class="next-post">
			
				<a href="/2015/08/19/dynamic-ui-shiny.html">
					<span class="page-number">Creating dynamic UI components in Shiny</span>
					<span class="fa-stack fa-lg">
						<i class="fa fa-square fa-stack-2x"></i>
						<i class="fa fa-angle-double-right fa-stack-1x fa-inverse"></i>
					</span>
				</a>
			
		</span>
	</section>




<section class="disqus">
  <div id="disqus_thread"></div>
  <script type="text/javascript">
    var disqus_shortname = 'polyphant';

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
  </script>
  <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</section>



</div>
</div>

    </div>

    <footer class="site-footer">

  <div class="wrapper">

    <h3 class="footer-heading"><a href="/">Polyphant</a></h3>

    <div class="site-navigation">

      <p><strong>Site Map</strong></p>
      <ul class="pages">
        
        
        
        
          <li class="nav-link"><a href="/contact/">Contact</a>
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
          <li class="nav-link"><a href="/about/">About</a>
        
        
        
          <li class="nav-link"><a href="/tags/">Tags</a>
        
        
        
        
        
        
        
        
        
        
        
        
      </ul>
    </div>

    <div class="site-contact">

      <p><strong>Social</strong></p>
      <ul class="social-media-list">

        
          
          <li>
            <a href="https://twitter.com/polyphantastic" target="blank" title="Follow me on Twitter">
              <i class="fa fa-twitter"></i>
              <span class="username">polyphantastic</span>
            </a>
          </li>
          
        
          
        
          
          <li>
            <a href="https://github.com/polyphant1" target="blank" title="Fork me on GitHub">
              <i class="fa fa-github"></i>
              <span class="username">polyphant1</span>
            </a>
          </li>
          
        
          
          <li>
            <a href="https://uk.linkedin.com/in/lovellchristopher" target="blank" title="Connect with me on LinkedIn">
              <i class="fa fa-linkedin"></i>
              <span class="username">LinkedIn</span>
            </a>
          </li>
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        

        <a href="/about#about-social">More...</a>
      </ul>
    </div>

    <div class="site-signature">
      <p class="rss-subscribe text"><strong>Subscribe <a href="/feed.xml">via RSS</a></strong></p>
      <p><i>Copyright &#169; 2016 Christopher Lovell</i></p>
    </div>

  </div>

</footer>

<!-- Scripts -->
<script src="//code.jquery.com/jquery-1.11.2.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.5/highlight.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/lightbox2/2.7.1/js/lightbox.min.js"></script>
<script>

$(document).ready(function() {

  // Syntax highlighting
  hljs.initHighlightingOnLoad();

  // Header
  var menuToggle = $('#js-mobile-menu').unbind();
  $('#js-navigation-menu').removeClass("show");
  menuToggle.on('click', function(e) {
    e.preventDefault();
    $('#js-navigation-menu').slideToggle(function(){
      if($('#js-navigation-menu').is(':hidden')) {
        $('#js-navigation-menu').removeAttr('style');
      }
    });
  });


});

</script>


<!-- Google Analytics -->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-61827184-1', 'auto');
  ga('send', 'pageview', {
    'page': '/2015/08/09/google-places-api.html',
    'title': 'Finding a cash machine with the Google Places API '
  });
</script>



  </body>

</html>
